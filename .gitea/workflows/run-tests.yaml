name: Run Tests

on:
  push:
    branches: '*'
  pull_request:
    branches: '*'

jobs:
  trigger-main-build:
    runs-on: ubuntu-latest
    container:
      image: refringe/spt-build-node:1.0.7
    steps:
    - name: Clone
      run: |
        rm -rf /workspace/SPT-AKI/Build/server
        git clone https://dev.sp-tarkov.com/SPT-AKI/Server.git --branch master /workspace/SPT-AKI/Build/server

        cd /workspace/SPT-AKI/Build/server
        git checkout ${GITHUB_SHA}
      shell: bash

    - name: Pull LFS Files
      run: |
        cd /workspace/SPT-AKI/Build/server
        git lfs pull
        git lfs ls-files
      shell: bash

    - name: Install NPM Dependencies
      run: |
        cd /workspace/SPT-AKI/Build/server/project
        npm install
      shell: bash

    - name: Run Tests
      run: |
        cd /workspace/SPT-AKI/Build/server/project
        npm run test
      shell: bash
